# start a simple cluster

docker network create rabbitmq-cluster

docker run -d --rm --net rabbitmq-cluster --hostname rabbit1 --name rabbit1 -e RABBITMQ_ERLANG_COOKIE='c09e0b80-3a0d-11ef-9d10-93fbbd65611e' -p 5672:5672 -p 15672:15672 rabbitmq:3-management

docker run -d --rm --net rabbitmq-cluster --hostname rabbit2 --name rabbit2 -e RABBITMQ_ERLANG_COOKIE='c09e0b80-3a0d-11ef-9d10-93fbbd65611e' -p 5673:5672 -p 15673:15672  rabbitmq:3-management

docker run -d --rm --net rabbitmq-cluster --hostname rabbit3 --name rabbit3 -e RABBITMQ_ERLANG_COOKIE='c09e0b80-3a0d-11ef-9d10-93fbbd65611e' -p 5674:5672 -p 15674:15672 rabbitmq:3-management

docker exec -it rabbit2 rabbitmqctl stop_app
docker exec -it rabbit2 rabbitmqctl reset
docker exec -it rabbit2 rabbitmqctl join_cluster rabbit@rabbit1
docker exec -it rabbit2 rabbitmqctl start_app

docker exec -it rabbit3 rabbitmqctl stop_app
docker exec -it rabbit3 rabbitmqctl reset
docker exec -it rabbit3 rabbitmqctl join_cluster rabbit@rabbit1
docker exec -it rabbit3 rabbitmqctl start_app

# configurar politica de alta disponibilidade:
docker exec -it rabbit1 rabbitmqctl set_policy ha-all ".*" '{"ha-mode":"all"}'